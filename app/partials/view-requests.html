<div class="clearfix" ng-show="groupBy">

    <div class="btn-group">
        <button class="btn text">GROUP BY:</button>
        <button type="button" class="btn btn-link" ng-model="groupBy" btn-radio="'course'">Course</button>
        <button type="button" class="btn btn-link" ng-model="groupBy" btn-radio="'status'">Status</button>
        <button type="button" class="btn btn-link" ng-model="groupBy" btn-radio="'unit'">Unit</button>
        <button type="button" class="btn btn-link" ng-model="groupBy" btn-radio="'MDS'">MDS</button>
        <button type="button" class="btn btn-link" ng-model="groupBy" btn-radio="'AFSC'">AFSC</button>
    </div>

    <div class="btn-group">
        <button class="btn text">SORT BY:</button>
        <button type="button" class="btn btn-link" sorter="status" text="Status" default></button>
        <button type="button" class="btn btn-link" sorter="course" text="Course"></button>
        <button type="button" class="btn btn-link" sorter="unit" text="Unit"></button>
        <button type="button" class="btn btn-link" sorter="AFSC"></button>
    </div>

    <div class="pull-right">
        <input type="search" class="search" ng-model="searchText.$" placeholder="Search this page..."/>
    </div>

</div>

<div class="{{wellCollapse}}">

    <div ng-repeat="(header, group) in groups" style="margin-bottom: 50px">

        <h3 style="border-bottom: 1px solid; margin-top:5px; margin-bottom:15px" ng-show="filtered.length">
            {{header}} <span
                class="pull-right">{{filtered.length}}<span
                ng-hide="filtered.length == group.length">  of {{group.length}}</span></span>
        </h3>

        <div class="well request{{r.status}}" ng-class="{'true':'expanded'}"
             ng-repeat="r in filtered = (group | search:searchText.$)">

            <div class="statusBackground">{{r.status}}</div>

            <h4 ng-click="r.expand = !r.expand">
                <icon path="{{r.icon}}"></icon>
                {{r.Course.PDS}} - {{r.reqSeats}} Requested ({{r.openSeats}} Open)
            <span class="pull-right" style="letter-spacing: .1em">{{r.start}} - {{r.end}}
                <icon path="calendar_range"></icon>
            </span>
            </h4>

            <hr class="rollup">

            <div class="rollup">

                <p class="lead" ng-hide="groupBy=='course'">{{r.Course.Number}}: {{r.Course.Title}}</p>

                <div class="col-lg-7 pull-left">

                    <table class="table table-split no-border">
                        <tbody>
                        <tr>
                            <td style="width:150px">Location</td>
                            <td style="width:10px">
                                <icon path="location"></icon>
                            </td>
                            <td><b>{{r.det.Base}} (Detachment {{r.det.Det}})</b></td>
                        </tr>
                        <tr>
                            <td>Instructor</td>
                            <td>
                                <icon path="instructor"></icon>
                            </td>
                            <td class="truncate bold">{{r.instructor}}</td>
                        </tr>
                        <tr>
                            <td>Requested</td>
                            <td>
                                <icon path="sent"></icon>
                            </td>
                            <td><b>{{r.Created}}</b></td>
                        </tr>
                        <tr>
                            <td>Comments</td>
                            <td>
                                <icon path="comments"></icon>
                            </td>
                            <td class="bold">
                                <button popover="{{r.notes}}"
                                        popover-append-to-body="true"
                                        popover-placement="right"
                                        popover-trigger="mouseenter"
                                        popover-title="{{r.CreatedBy.Name}} ({{r.CreatedBy.WorkPhone}})"
                                        class="btn btn-link btn-inline btn-muted">By Requester
                                </button>
                                <span ng-if="r.responseText">
                                    &nbsp;-&nbsp;
                                    <button popover="{{r.responseText}}"
                                            popover-append-to-body="true"
                                            popover-placement="right"
                                            popover-trigger="mouseenter"
                                            popover-title="{{r.responseName}}"
                                            class="btn btn-link btn-inline btn-muted">FTD Response
                                    </button>
                                </span>
                            </td>
                        </tr>
                        </tbody>
                    </table>

                </div>

                <div class="col-lg-5 pull-right text-right">

                    <p ng-repeat="s in r.Students.results" style="margin-bottom: 10px" class="bold truncate">
                        <icon path="student_hand" hover="Requested Student"></icon>
                        <a href="mailto:{{s.WorkEMail}}{{r.mail}}">{{s.Name}}</a><br>
                        <span ng-show="s.WorkPhone">{{s.WorkPhone}}</span>
                    </p>

                </div>

                <div class="clearfix"></div>

                <div class="requestActions" ng-if="r.Status < 2">
                    <hr>
                    <div class="col-lg-9 pull-left" style="margin-top: 8px">

                        <table class="table-tiny" style="width:20%">
                            <thead style="font-size:1.2em">
                            <th>{{r.Course.Min}}</th>
                            <th>{{r.Course.Max}}</th>
                            </tdead>
                            <tbody>
                            <tr>
                                <td>Min</td>
                                <td>Max</td>
                            </tr>
                            </tbody>
                        </table>
                        <table class="table-tiny">
                            <thead style="font-size:1.2em">
                            <th>{{r.Scheduled.Host}}</th>
                            <th>{{r.Scheduled.Other}}</th>
                            <th>{{r.approvedSeats}}</th>
                            </tdead>
                            <tbody>
                            <tr>
                                <td>Host</td>
                                <td>Other</td>
                                <td>Approved</td>
                            </tr>
                            </tbody>
                        </table>
                        <table class="table-tiny">
                            <thead style="font-size:1.2em">
                            <th>{{r.reqSeats}}</th>
                            <th>{{r.pendingSeats}}</th>
                            <th>{{r.openSeats}}</th>
                            </tdead>
                            <tbody>
                            <tr>
                                <td>Requested</td>
                                <td>Pending</td>
                                <td>Open</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="pull-right">
                        <button type="button" class="btn btn-success btn-labeled btn-muted">
                            <span class="btn-label invert"><icon path="approve"></icon></span>&nbsp;Approve
                        </button>
                        <button type="button" class="btn btn-danger btn-labeled btn-muted"><span
                                class="btn-label invert"><icon path="deny"></icon></span>&nbsp;Deny
                        </button>
                    </div>
                    <div class="clearfix"></div>
                </div>

            </div>

        </div>

    </div>

</div>